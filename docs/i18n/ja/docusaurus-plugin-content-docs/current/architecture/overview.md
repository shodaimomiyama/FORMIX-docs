---
sidebar_position: 1
---

# アーキテクチャ概要

FORMIXは**6層クリーンアーキテクチャ**パターンに従い、関心の分離と保守性を確保しています。

## レイヤー構造

```
┌─────────────────────────────────────────┐
│           Actions層                      │  ← 外部API
├─────────────────────────────────────────┤
│         Use Cases層                      │  ← アプリケーションロジック
├─────────────────────────────────────────┤
│          Domain層                        │  ← ビジネスルール
├─────────────────────────────────────────┤
│       Infrastructure層                   │  ← 外部サービス
├─────────────────────────────────────────┤
│        Interfaces層                      │  ← 抽象化
├─────────────────────────────────────────┤
│          Config層                        │  ← 設定
└─────────────────────────────────────────┘
```

## レイヤーの説明

### Actions層
すべての外部インタラクションのエントリーポイント。このレイヤーは：
- パブリックAPIを公開
- 入力バリデーションを処理
- ユースケースの実行をオーケストレーション
- フォーマットされたレスポンスを返却

```rust
// 例：Actions層の関数
pub fn encrypt_secret(
    public_key: &PublicKey,
    data: &SecretData,
) -> Result<(Capsule, Ciphertext), ActionError>
```

### Use Cases層
アプリケーション固有のビジネスロジックを含む：
- ユーザーストーリーとワークフローを実装
- ドメインエンティティを調整
- トランザクション境界を処理

### Domain層
外部の関心事から独立したコアビジネスロジック：
- **エンティティ**: `Secret`、`Capsule`、`KFrag`、`CFrag`
- **値オブジェクト**: `KeyPair`、`SecretData`、`PublicKey`
- **ドメインサービス**: 暗号操作

### Infrastructure層
外部統合を実装：
- Arweaveストレージクライアント
- AO Networkプロセス管理
- EVMコントラクトインタラクション

### Interfaces層
インフラストラクチャの抽象化を定義：
- リポジトリインターフェース
- 外部サービスコントラクト
- イベント定義

### Config層
システム設定と定数：
- ネットワークパラメータ
- 暗号定数
- 機能フラグ

## プロセスアーキテクチャ

FORMIXは3つの異なるAOプロセスを通じて動作します：

```
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│    Owner     │    │    Holder    │    │  Requester   │
│   Process    │    │   Process    │    │   Process    │
├──────────────┤    ├──────────────┤    ├──────────────┤
│ - 暗号化     │    │ - 保存       │    │ - 要求       │
│ - KFrag生成  │───▶│ - 配布       │◀───│ - 収集       │
│ - 認可       │    │ - 再暗号化   │    │ - 復号       │
└──────────────┘    └──────────────┘    └──────────────┘
        │                   │                   │
        └───────────────────┴───────────────────┘
                           │
                    ┌──────────────┐
                    │   Arweave    │
                    │   Storage    │
                    └──────────────┘
```

### Ownerプロセス
- 暗号鍵を生成・管理
- シークレットを作成・暗号化
- 再暗号化鍵フラグメント（KFrag）を生成
- アクセスポリシーを定義

### Holderプロセス
- 暗号化データ参照を保存
- KFrag配布を維持
- 再暗号化操作を実行
- プロキシノード調整を管理

### Requesterプロセス
- アクセス要求を開始
- 再暗号化フラグメント（CFrag）を収集
- 最終復号を実行
- データ整合性を検証

## データフロー

1. **暗号化**: Ownerがデータを暗号化 → Capsule + Ciphertext
2. **鍵生成**: OwnerがKFragを作成 → プロキシに配布
3. **保存**: CiphertextをArweaveに保存
4. **要求**: Requesterがアクセスを要求
5. **再暗号化**: プロキシがCFragを生成
6. **復号**: RequesterがCFragを結合 → 復号

## 次のステップ

- [6フェーズワークフロー](/docs/architecture/six-phase-workflow) - 詳細なプロトコルフロー
- [セキュリティ特性](/docs/architecture/security) - 暗号保証
